@model Aula
@{
    ViewData["Title"] = "Aula";
}

@section Styles{
    <link href="~/css/SwitchButton.css" rel="stylesheet" />
}

<h2>Aula</h2>
<br />
<div class="list-group">
    <div class="list-group-item">
        <form role="form" asp-action="Aula" method="post">
            <input asp-for="Id" type="hidden" />
            <input asp-for="ProfessorId" type="hidden" />
            <input asp-for="SalaId" type="hidden" />
            <input asp-for="CursoId" type="hidden" />
            <input asp-for="DataLimite" type="hidden" />

            <div class="row">
                <div class="col-md-2">
                    <div class="form-group">
                        <label asp-for="Data"></label>
                        <input asp-for="Data" hidden />
                        <input value="@Model.Data.ToString("dd/MM/yyyy HH:mm'h'")" disabled class="form-control" />
                        <span asp-validation-for="Data"></span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label asp-for="Professor"></label>
                        <input asp-for="Professor.Nome" class="form-control" disabled />
                        <span asp-validation-for="Data" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label asp-for="Curso"></label>
                        <input asp-for="Curso.Nome" class="form-control" disabled />
                        <span asp-validation-for="Curso" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label asp-for="Sala"></label>
                        <input asp-for="Sala.Nome" class="form-control" disabled />
                        <span asp-validation-for="Sala" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group">
                        <label asp-for="DescAtividades"></label>
                        <textarea asp-for="DescAtividades" rows="10" cols="80">
                    </textarea>
                        <span asp-validation-for="DescAtividades" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <hr />

            @for (int i = 0; i < Model.Chamadas.Count; i++)
            {
                <div class="row">

                    <div class="col-md-1">
                        <label>Histórico</label>
                        <div class="dropdown">
                            <button class="btn btn-primary" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-history"></i>
                            </button>
                            <div class="dropdown-menu" style="width: 320px; height: 500px; overflow-y: scroll;" aria-labelledby="dropdownMenuButton">
                                @{
                                    var chamada = Model.Chamadas[i].PacoteCompra.Chamadas
                                    .OrderByDescending(c => c.Aula.Data)
                                    .FirstOrDefault(c => c.Presenca == true);
                                    if (chamada != null)
                                    {
                                        <div class="container">
                                            @Html.Raw(chamada.Aula.DescAtividades)

                                            @if (chamada.Observacao != null)
                                            {
                                                <hr />
                                                <div>@chamada.Observacao</div>
                                            }
                                        </div>

                                    }
                                }
                            </div>
                        </div>
                    </div>


                    <input id="qtdAluno" value="@Model.Chamadas.Count" type="hidden" />
                    <input asp-for="Chamadas[i].Id" type="hidden" />
                    <input asp-for="Chamadas[i].AulaId" type="hidden" />
                    <input asp-for="Chamadas[i].PacoteCompraId" type="hidden" />
                    <input asp-for="Chamadas[i].Presenca" type="hidden">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label asp-for="Chamadas[i].PacoteCompra.Matricula.Aluno"></label>
                            <input value="@Model.Chamadas[i].PacoteCompra.Matricula.Aluno.Nome" class="form-control" disabled />
                        </div>
                    </div>
                    <div class="col-md-1">
                        <div class="col-md-2">
                            <div class="form-group">
                                <label id="labelSwitch@(i)">Presente</label><br />
                                <label class="switch">
                                    <input id="switch@(i)" onclick="presenca(@i)" type="checkbox">
                                    <span class="slider round"></span>
                                </label>
                                <span asp-validation-for="Chamadas[i].Presenca" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7">
                        <div class="form-group">
                            <label asp-for="Chamadas[i].Observacao"></label>
                            <input asp-for="Chamadas[i].Observacao" class="form-control" />
                            <span asp-validation-for="Chamadas[i].Observacao" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            }
            <br />
            <button type="submit" class="btn btn-success col-md-4">Lançar</button>
        </form>
    </div>
</div>
<br />
@section Scripts{
    <script src="~/js/mask.js"></script>
    <script src="~/ckeditor/ckeditor.js"></script>
    <script>
        // Replace the <textarea id="editor1"> with a CKEditor
        // instance, using default configuration.
        CKEDITOR.replace('DescAtividades');
    </script>
    <script src="~/js/Aula.js"></script>
}